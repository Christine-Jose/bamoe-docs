= BPMN Editor
IBM; KIE Community
include::../partials/attributes.adoc[]

Decision authoring on {CANVAS} happens inside the Editor page for Workflow, where you can edit, and validate BPMN files.

Let's start by describing the elements present on the BPMN Editor.

.Editor page for a Workflow on {CANVAS} with highlighted elements of the BPMN Editor
image::tools/image5.jpg[]

[upperalpha]
. *Node palette* → From here you can select node types and its variations.
. *Side panel strip* → Lets you select which side panel you want to toggle.
  From top to bottom, those are the available panels:
[loweralpha]
.. Properties → Lets you manage the properties of a Workflow element.
.. Navigator → Displays a minimap with the diagram of your Workflow and a list of all elements present on it.
. *Keyboard shortcuts panel toggle →* Clicking here toggles a panel with information of keyboard shortcuts available on the BPMN Editor.

Toggling the Problems tab lets you see static validation errors that {CANVAS} reports while you're developing your Workflows.

Developing Workflows through BPMN files is a complex subject and has many intricacies that are out of the scope of this document.
Please refer to BPMN-specific material, like the https://www.omg.org/spec/BPMN/2.0.2/PDF[BPMN specification] itself.

== Invoking a Decision from a Workflow

A common use-case for Workflows is to invoke Decisions as part of its logic.
Luckily, it's very easy to achieve that on {CANVAS}.
On your Workflow, create a new “Business Rule” task node.

.Node palette open for Task nodes inside the BPMN Editor on {CANVAS}
image::tools/image9.png[]

Open the “Properties” panel using the first icon at the “Side panel strip” and look for Implementation/Execution.
There, you can change the “Rule language” to “DMN”. Select the File you want and the Decision inside it.
Here's an example:

.Implementation/Execution section of the Properties panel for a Business Rule Task inside a Workflow invoking a Decision on {CANVAS}
image::tools/image23.png[]

When your Workflow executes, this Decision will be invoked with the inputs being passed to the Business Rule task.
The result of the Decision will be the output of the Business Rule task.

== Running Decisions

Developing a Decision can be very complex, depending on the number of rules you have on Decision Tables and the possibilities you have available with the many values that compose its inputs.
{CANVAS} allows you to run your Decisions while developing them, making it easy for you to test scenarios and reproduce them after you make changes.
It's also very useful for quickly evaluating a set of inputs.
We call this capability of running Decision while developing them “DMN Runner”.

When you open the Editor page for Decisions, you have an extra “Run” button available at the top-right, as you see in the figure below.
Clicking this button will open the DMN Runner panel, being it a Form or a Table.
You can easily switch between the modes by clicking the Table icon at the first column of the Form mode and by clicking the Form icon at the Table rows individually.

Let's create a new Decision from one of the Samples provided by {CANVAS}.
On the Home screen, select “Try sample” on the Decision card.
When you click the “Run” button, you'll see the screen below.
Let's see what those elements are.

.Editor page for a Decision on {CANVAS} with highlighted elements of the DMN Runner in Form mode
image::tools/image15.jpg[]

[upperalpha]
. *Run button* → Lets you show/hide DMN Runner panels.
  Clicking the arrow lets you select the mode you want -- Table or Form.
  It's also possible to Download/load inputs, or delete them.
  Deleting inputs is a permanent operation and cannot be undone.
. *Add input row button* → Clicking this button will create a new set of inputs.
  On the Form mode, you can only see one “row” at the time.
  To see all your input rows at the same time, switch to the Table mode.
. *Table mode button* → Switches DMN Runner to Table mode.

Let's add a new input row and switch to Table mode and look at the DMN Runner elements.

.Editor page for a Decision on {CANVAS} with highlighted elements of the DMN Runner in Table mode
image::tools/image11.jpg[]

[upperalpha]
. *Show row in Form mode button* → Switches DMN Runner to Form mode and displays the selected row.
. *“Run” tab* → Lets you quickly show/hide the DMN Runner Table.
  Clicking this button is the same as clicking the “Run” button at the top-right.

DMN Runner remembers the mode you used for each file, so if you use the File switcher to move between files, you can see DMN Runner switching modes, depending on the last mode you used for each file.

Now that you're familiar with the DMN Runner controls, running your Decision with your input rows is easy.
Just fill the input fields and see the results live at the Outputs column in Form mode, or the right-hand-side Table in Table mode.

If you're familiar with the DMN Boxed Expression Editor, you'll be very comfortable navigating through the DMN Runner Table, as they share the same Table component.

DMN Runner will infer the type of your inputs from their Data Types.
We encourage you to keep your Data Types organized for better maintainability of your Decision, and to extract the most of what DMN Runner has to offer.

Loading an inputs file with unmatching input names and/or Data Types will ignore the unmatching inputs.

=== Limitations

* Recursive Struct Data Types are not yet supported.
  You'll see a placeholder component where the inputs should be if you have one of those in your Decision.
* Your input data is not versioned as part of your repository, and they are persisted only in your browser.
  They are saved to disk, so you can safely close your tabs and restart your computer.
  If you want to share a set of inputs, use the “Download inputs” and the “Load inputs” button in the “Run” select.
* Undo/redo operations are not yet supported on the DMN Runner.
* Changing a Data Type can potentially erase all the values you have for an input.
* Renaming an input will delete the input values previously saved.

== Creating Dev deployments for Decisions

{CANVAS} allows you to connect with local Kubernetes instances and/or remote Kubernetes/OpenShift instances.
Setting those up can be done at the “Accounts modal”, which can be opened using the little person icon at the top-right.
Selecting Kubernetes or OpenShift will give you instructions on how to do it.
For more information see “Connecting accounts”.

This connection lets you deploy all Decisions in your project, for development purposes only.
With any Decision of your project open, select the connected account you want to use to make your Dev deployment and confirm.

.Deploy dropdown for a project called “tiagobento/myProject” on {CANVAS}
image::tools/image13.png[]

Once you confirm your Dev deployment, the Dev deployments dropdown will open, and you'll be able to see the Decisions you deployed.

image:tools/image25.png[] image:tools/image10.png[]
_“Dev deployments dropdown” showing the process of deploying a project called “tiagobento/myProject” on {CANVAS}._

After ~30 seconds you should be able to see your Dev deployment with a green check.
Clicking the item on this dropdown will take you to a special web application {CANVAS} provides for Dev deployments.
This web app lets you select which Decision from your project you want to work with, and provides a form much like DMN Runner's. You get a link for the Swagger UI with your Decisions' API information.

.Dev deployment app for a Decision, created from {CANVAS}
image::tools/image3.png[tools/image3,width=490,height=404]

*↑ Change this screenshot to one with the {CANVAS} logo?*

You can change the Decision using the Select at the top-right.
Opening Swagger UI can be done using the little Kebab menu at the top-right.

Use Dev deployments to share your work with others, or even to integrate it with other applications your team might be developing.

Dev deployments are immutable, so if you made a mistake, or simply want to make a change, create a new Dev deployment.
You can easily delete Dev deployments from the Dev deployments dropdown.

== Limitations

* All Decisions inside your project are included in a Dev deployment.
  If there's an error in any of them, the Dev deployment won't succeed.
* Only Decisions are supported at the moment, meaning you can't deploy Workflows.
  If you have Workflows in your project, they're going to be ignored by the Dev deployment.

== Connecting accounts

As mentioned previously, {CANVAS} doesn't feature its own authentication mechanism.
Instead, {CANVAS} allows you to link your existing accounts from your Git and Cloud providers.
These accounts are used when performing Git operations like Pull and Push, and when creating Dev deployments, respectively.

All your connected accounts are visible at the Accounts modal.
It is accessible through the little person icon at the top-right corner.
There you can see how many repositories and deployments are using those accounts.
It is also possible to visualize information about those accounts, such as the date it was linked on {CANVAS}.

You can remove accounts from {CANVAS} using the Accounts modal.
By doing so, repositories linked to Git provider accounts will lose the ability to Push and Pull.
You can change the account linked to a repository at any time, using the Select available on the Editor page of any file of your repository.

.Accounts modal on {CANVAS}
image::tools/image17.png[]

It shows two connected accounts, one from an OpenShift instance, and another from GitHub, respectively._
