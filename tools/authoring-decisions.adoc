= Authoring Decisions
include::../partials/attributes.adoc[]

Decision authoring on {CANVAS} happens inside the Editor page for Decisions, where you can edit, validate, run, and deploy DMN files.

We have developed a brand new DMN Editor compatible with the DMN specification 1.5. For the purpose of reduce ambiguity on the documentation we will address this editor as the New DMN Editor, and the previous one as the Legacy Editor. It's important to notice that it is still possible to use the Legacy Editor, but bear in mind that files edited on the New DMN Editor will not be compatible with the Legacy DMN Editor, even though the opposite is possible.

By default the New DMN Editor will be opened, and the user can choose to switch to the Legacy DMN Editor by clicking into the "New DMN Editor" dropdown and selecting the "Switch back to the legacy DMN Editor". This operation will save the user preference to keep using the Legacy DMN Editor.

.Switch to Legacy DMN Editor
image::tools/authoringDecisions/switch-to-legacy.gif[]

To switch back to the New DMN Editor the user can click on the "Try the new DMN Editor".

.Switch to New DMN Editor
image::tools/authoringDecisions/switch-to-new.gif[]

== New Editor

On the this section we will cover the New DMN Editor. We start with an Overview, showing what additional capabilities it has, then we make an in depth analisys of its features and how to use them.

=== Overview

The New DMN Editor has the capability to open and edit DMNs from version 1.5 or below, but it will always save as a DMN 1.5. This is important as it will not be possible to open the file generated by it on other editors that don't support version 1.5, like the Legacy DMN Editor.

The Legacy DMN Editor supports DMN version 1.2 with some additional 1.3 capabilities, making this a huge step in functionalities. Here we summarize those.

=== version 1.3

The Legacy DMN Editor already supported some 1.3 features, such as the temporal FEEL Functions. A new addition is the Group node, a different type of artifact. It enables the user to create groups on the DRD, enhancing the experience by providing a better way to organize and visualize the model.

.Group node
image::tools/authoringDecisions/overview-1.3-group-node.png[width=300]

=== version 1.4

This version adds new functionalities for the FEEL functions, Boxed Expression and DRD representation.

. FEEL Functions

The following FEEL functions were added: "context", "context put", "context merge", "number floor", "number ceiling", "number round up", "number round down", "number round half up", "number round half down" and "string join".

[start=2]
. Boxed Expression

Adds the Filter, Conditional, Iterator, Every and Some Boxed Expressions.

[start=3]
. DRD

Adds a marker on the DRD for nodes that has a collection data type.

.Collection mark
image::tools/authoringDecisions/overview-1.4-collection-marker.png[width=300]

=== version 1.5

This version adds new FEEL Functions, changes to the DRD and some general changes for the DMN model.

. FEEL Functions

Adds the "list replace" function, and the scientific notation.

[start=2]
. DRD

Adds the representation of an alternative Input Data node which has a visual cohesion to the BPMN model. This alternative visual representation is a DRD option, affecting all Input Data nodes on the DRD. More about this on the DRD section.

.alternative Input Data node representation
image::tools/authoringDecisions/overview-1.5-alternative-input-data-node.png[width=150]

[start=3]
. General

.. Import to default namespace -> adds the possibility to import a new DMN into the default namespace. This removes the necessity to give a name to the external model, giving the possibility to have multiple files composing one unique model under the same namespace.

.Previous missing functionalities
One of the missing functionalities on our legacy editor that was added on the new one is the visual representation for nodes that have missing dependencies on the current DRD.

You can have multiple DRDs and not necessarily import all nodes. This visual representation helps to show the missing requirements in the current DRD.

.DRD1 with an My Input node as dependency of the My Decision node
image::tools/authoringDecisions/overview-missing-functionalities-ellipsis-1.png[width=300]

.DRD2 with the My Decision node without the My Input dependency.
image::tools/authoringDecisions/overview-missing-functionalities-ellipsis-2.png[width=300]

---

=== The Editor

Here we show all the functionalities of the New DMN Editor.

.New DMN Editor overview
image::tools/authoringDecisions/new-editor-overview.png[]

The diagram and boxed expression editor can be accessed on A. The data types editor can be access on B and to manage the included models we have C.

=== A. Diagram

Opening the diagram for the first time we have a few components to pay attention, and here we enumerate them.

.New DMN Editor diagram overview
image::tools/authoringDecisions/new-editor-diagram-overview.png[]

. The editor empty state.

Here you can easily create a starting decision table or a decision with input data node;

[start=2]
. The node Palette:
.. DRG nodes;
.. Artifact nodes;
.. All DRG nodes;
.. External nodes.

[start=3]
. The DRD dropdown.

The place where you can change the current opened DRD, rename it or change its properties.

[start=4]
. The properties panel of the selected element;
. The overlay panel, with customizable style and visualization properties
. The auto layout button, to help you organize your DRD;
. The canvas properties, where you can control the zoom or what you are visualizing.

On the next sections we will explain more about of these functionalities.

==== 1.Empty state

The empty state enables the user to easily bootstrap a new DMN. It has two options:

. New Decision Table

Creates a new Decision node with an empty Decision Table.

.Decision node with a Decision Table
image:tools/authoringDecisions/new-editor-diagram-empty-state-decision-node.png[width=300px]
image:tools/authoringDecisions/new-editor-diagram-empty-state-decision-table.png[width=300px]

[start=2]
. New Decision with Input Data

Creates a new Input Data and Decision node with an Information Requirement relationship.

.Input Data and Decision nodes
image::tools/authoringDecisions/new-editor-diagram-empty-state-input-decision.png[width=300px]

==== 2.Palette

The Palette enables the user to interact with the DRD and DRG. It's possible to add a new node, to use nodes from other DRDs, add nodes from external models, and to create artifact nodes, improving documentation, organization and visualization.

.a. Add DRG node

To add a new DRG node the user needs to drag the desired node from the palette and drop it into the diagram.

.Dragging a new Input Data node from the Palette
image::tools/authoringDecisions/new-editor-diagram-drag-from-palette.gif[width=300px]

.b. Artifact nodes

The artifact nodes give the user the tools to improve the documentation and visualization of the DRG by modifying the DRD. The Group node creates a visual separation, and the Text Annotation enables to write a small documentation.

.c. All DRG nodes

Clicking on it will open a modal where we have access to the list of all DRG nodes that are part of the current file. It's possible to filter the nodes by name, and nodes that are part of the current DRD are grayish. Clicking and dragging the node name to the diagram will add the node to the current DRD. More about this can be found at the DRD section.

.Dragging a Decision node from DRG nodes
image::tools/authoringDecisions/new-editor-diagram-palette-all-drg-nodes.gif[width=300px]

.d. External nodes

All nodes that are part of the included models can be found here. Clicking on it will open a modal showing all nodes separated by namespace, where you can filter the nodes by name.

.Dragging an external Input Data node
image::tools/authoringDecisions/new-editor-diagram-palette-external-nodes.gif[width=300px]

Additionally, it's possible to see the chosen name for the included model and the DMN file name from where it comes from. On the above example the name is “ex” and the filename “Another DMN.dmn”.

==== Nodes

On this section we explore all node features, for this we will be using a Decision node.

.Decision node components
image::tools/authoringDecisions/new-editor-diagram-node-overview.png[width=300px]

. Node name

The node name has a uniqueness validation. The editor doesn't allow you to rename a node to a name that is already being used by another node. Empty names are also invalid. Trying to rename a node to an invalid one will cause it to rollback to its previous name. The only moment you can have nodes with the same name is when you create two or more nodes of the same type without renaming it. The following example illustrate two Decision nodes that were created without renaming, and an Input Data node where we try to rename it to “New Decision”, and after it to an empty name.

.Node unique name
image::tools/authoringDecisions/new-editor-diagram-node-unique-name.gif[width=300px]

[start=2]
. Node type

Nodes that have a data type, shows this information on top of the node. It's possible to change the node data type using the dropdown menu, or even access a custom data type to have a better visualization of the type. More about the Data Types are covered on the B section.

.Editing node data type
image::tools/authoringDecisions/new-editor-diagram-node-data-type.gif[width=300px]

[start=3]
. New relationship

It's possible to create a new requirement or association relationship from the target node to another  node respecting the DMN specification. The available options varies from node to node.

.Create new relationship
image::tools/authoringDecisions/new-editor-diagram-node-new-relationship.gif[width=300px]
 
[start=4]
. New connected node

It's possible to create a new connected node from the target node. It will create a node with the respective relationship. The available options varies based on the node type and respects the DMN specification.

.Create new connected node
image::tools/authoringDecisions/new-editor-diagram-node-new-connected.gif[width=300px]
 
[start=5]
. Edit

The Edit button is only available for the Decisions and BKM nodes. Clicking on it, opens the DMN Boxed Expression Editor with the node expression. The Boxed Expression Editor have access to the DRG context, and are powered by an auto completion tool, enhancing the user experience when building their expressions.

.Open node Boxed Expression Editor
image::tools/authoringDecisions/new-editor-diagram-node-boxed-expression-editor.gif[width=500px]

[start=6]
. Properties panel

Clicking on this button, will open the Properties Panel of the node. On this panel it's possible to check and edit the node name, type, description, allowed answer, documentation links, font styles, and shape styles. Also it's possible to check the node ID. More about this can be read on the "Properties Panel” section.

.Open node properties panel
image::tools/authoringDecisions/new-editor-diagram-node-properties-panel.gif[width=500px]

[start=7]
. Resize handler

Clicking on the small arrow and dragging around it's possible to resize the target node. Each node has a minimal width and height, trying to resize to a smaller size will not affect the node.

.Resize node
image::tools/authoringDecisions/new-editor-diagram-node-resize.gif[width=500px]

.Decision Service

. TODO

.Unkown node

. TODO

==== 3.DRD

The new editor gives us a brand new experience related to the DRDs, on the image below we can have an overview of this functionality

.DRD Overview
image::tools/authoringDecisions/new-editor-diagram-drd-overview.png[width=500px]

Clicking on 1 will open the DRD dropdown. To edit the DRD name, you can click on its name and type the new desired name. On 2 you can create new DRDs, which will automatically change to a new empty DRD. The 3 is the list of DRDs on the DRG. Finally, 4 is the DRD options of the selected DRD.

.DRG nodes overview
image::tools/authoringDecisions/new-editor-diagram-drg-nodes-overview.png[width=500px]

On the example above, the user has created a new DRD, and has it renamed to DRD2, which we can see on 1. Clicking on 2 will open the DRG nodes (3). On this example, the “My Decision” and “Person” nodes are present on the DRG but not in the current DRD. By clicking on it and dragging into the diagram the node will be added to the current DRD. This behavior is illustrate below.

.Dragging a new node from the DRG nodes list
image::tools/authoringDecisions/new-editor-diagram-drg-nodes-dragging.gif[width=500px]

It's possible to see that the “My Decision” became grayish on the DRG nodes modal, as it's now present on the current DRD. Also, it have a “three dot” mark on bottom of it, which tells us, this node have dependencies that are not shown on the current DRD. By dragging the “Person” node we can see the three dots disappearing, and an information requirement is automatically placed.

.DRD alteranative representation for the Input Data node
image::tools/authoringDecisions/new-editor-diagram-drd-overview-alternative-input.png[width=500px]

Also, it's possible to change the classic shape to an alternative one, making it more visual cohesive with the BPMN model. This change affects the entire DRD, so it's not possible to have just one node with the alternative shape.

== Legacy Editor

On the this section we will cover the Legacy DMN Editor.

.Editor page for a Decision on {CANVAS} with highlighted elements of the DMN Editor
image::tools/image7.jpg[Editor page for a Decision on {CANVAS} with highlighted elements of the DMN Editor]

. *DMN Editor tabs →* Here you can switch between the four screens that compose the DMN Editor.
[loweralpha]
.. Editor → Will display your DRG and DRDs you select.
   This is where you edit your DMN model and create relationships between its nodes.
.. Documentation → Will display a downloadable PDF containing the specification of your Decision.
.. Data Types → Lets you manage the Data Types that are part of your Decision.
.. Included Models → Lets you manage other Decisions you linked to your current Decision.
   Including a Decision lets you reuse nodes and Data Types from it.
. *Search button →* Lets you search specific elements of your Decision.
. *Side panel strip* → Lets you select which side panel you want to toggle.
  From top to bottom, those are the available panels:
[loweralpha]
.. Navigator → Displays all the elements of your Decision organized by DRG and DRDs, and types.
.. Properties → Lets you manage the properties of a Decision element.
.. Preview → Displays a minimap of your DRG.
. *Node palette →* From here you can select nodes and drag them into your DRG or DRDs..
. *Keyboard shortcuts panel toggle →* Clicking here toggles a panel with information of keyboard shortcuts available on the DMN Editor.

The DMN Editor lets you develop Decisions and Business Knowledge Models (BKMs) using the DMN Boxed Expression Editor.
Drag a new Decision or BKM node to the DRG and let's open it with the DMN Boxed Expression Editor.

image:tools/image6.png[tools/image6,width=181,height=100] image:tools/image2.png[tools/image2,width=187,height=103]

_Decision and Business Knowledge Model on the DMN Editor, side by side, showing their Edit button, that brings you to their implementations inside the Boxed Expression Editor, on {CANVAS}._

Selecting Edit on a new Decision will bring you to an empty Boxed Expression.
On a new BKM you'll have an empty Boxed Function.
The implementation of this Boxed Function can be of any type.

.Boxed Expression Editor for a new BKM inside the DMN Editor on {CANVAS}
image::tools/image28.png[width=300]

.Boxed Expression Editor for a new Decision inside the DMN Editor on {CANVAS}
image::tools/image19.png[width=300]

Selecting a Boxed Expression type will update the implementation of the Decision or BKM.

Here's an example Decision Table.

.Boxed Expression implementation example for a Loan Pre-Qualification Decision inside the DMN Editor, on {CANVAS}
image::tools/image4.png[]

And a BKM with a Literal implementation.

.Boxed Expression implementation example for a PITI BKM inside the DMN Editor, on {CANVAS}
image::tools/image18.png[width=500]

The Boxed Expression Editor is very capable, and can handle complex implementations.
It's built based on the same Table component {CANVAS} uses on DMN Runner, so you'll feel at home in both places.

Developing Decisions through DMN files is a complex subject and has many intricacies that are out of the scope of this document.
Please refer to DMN-specific material, like the https://www.omg.org/spec/DMN/1.3/PDF[DMN specification] itself.
